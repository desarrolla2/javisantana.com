<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <title>Tornado</title>

  <meta name="viewport" content="width=device-width"/>

  <link rel="stylesheet" href="./css/reset.css" type="text/css"/>
  <link rel="stylesheet" href="./css/showoff.css" type="text/css"/>

  <script type="text/javascript" src="./js/jquery-1.4.2.min.js"></script>
  <script type="text/javascript" src="./js/jquery.cycle.all.js"></script>
	<script type="text/javascript" src="./js/jquery-print.js"></script>
  <script type="text/javascript" src="./js/jquery.batchImageLoad.js"></script>

  <script type="text/javascript" src="./js/jquery.doubletap-0.1.js"></script>

  <script type="text/javascript" src="./js/fg.menu.js"></script>
  <script type="text/javascript" src="./js/showoff.js"></script>
  <script type="text/javascript" src="./js/jTypeWriter.js"> </script>
  <script type="text/javascript" src="./js/sh_main.min.js"></script>
  <script type="text/javascript" src="./js/core.js"></script>
  <script type="text/javascript" src="./js/showoffcore.js"></script>
  <script type="text/javascript" src="./js/coffee-script.js"></script>

  <link type="text/css" href="./css/fg.menu.css" media="screen" rel="stylesheet" />
  <link type="text/css" href="./css/theme/ui.all.css" media="screen" rel="stylesheet" />
  <link type="text/css" href="./css/sh_style.css" rel="stylesheet" >

  
    <link rel="stylesheet" href="file/tornado.css" type="text/css"/>
  

  

  <script type="text/javascript">
  $(function(){
      setupPreso(false, './');
  });
  </script>

</head>

<body>

<a tabindex="0" href="#search-engines" class="fg-button fg-button-icon-right ui-widget ui-state-default ui-corner-all" id="navmenu"><span class="ui-icon ui-icon-triangle-1-s"></span>slides</a>
<div id="navigation" class="hidden"></div>

<div id="help">
  <table>
    <tr><td class="key">z, ?</td><td>toggle help (this)</td></tr>
    <tr><td class="key">space, &rarr;</td><td>next slide</td></tr>
    <tr><td class="key">shift-space, &larr;</td><td>previous slide</td></tr>
    <tr><td class="key">d</td><td>toggle debug mode</td></tr>
    <tr><td class="key">## &lt;ret&gt;</td><td>go to slide #</td></tr>
    <tr><td class="key">c, t</td><td>table of contents (vi)</td></tr>
    <tr><td class="key">f</td><td>toggle footer</td></tr>
    <tr><td class="key">r</td><td>reload slides</td></tr>
    <tr><td class="key">n</td><td>toggle notes</td></tr>
    <tr><td class="key">p</td><td>run preshow</td></tr>
  </table>
</div>

<div class="buttonNav">
  <input type="submit" onClick="prevStep();" value="prev"/>
  <input type="submit" onClick="nextStep();" value="next"/>
</div>

<div id="preso">loading presentation...</div>
<div id="footer">
  <span id="slideInfo"></span>
  <span id="debugInfo"></span>
  <span id="notesInfo"></span>
</div>

<div id="slides" class="offscreen" style="display:none;">
<div class="slide" data-transition="none"><div class="content" ref="one/01_slide/1">
<h1>Tornado</h1>

<h2>python async web framework</h2>

<p> </p>

<p> @javisantana &#xB7; bcndevcon</p></div>
</div><div class="slide" data-transition="none"><div class="content" ref="one/01_slide/2">
<h1>about me</h1>

<ul>
<li>python developer since 2002</li>
<li>@vizzuality // @agroguia</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content center" ref="one/01_slide/3">
<p><img src="./file/one/cartodb2.png" alt="cartodb"/></p></div>
</div><div class="slide" data-transition="none"><div class="content center" ref="one/01_slide/4">
<p><img src="./file/one/neemo2.png" alt="neemo"/></p></div>
</div><div class="slide" data-transition="none"><div class="content intro" ref="one/01_slide/5">
<h1>index</h1>

<ul>
<li>intro async</li>
<li>intro tornado</li>
<li>tornado features (by example)</li>
<li>production</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content corte center" ref="one/01_slide/6">
<h1><strong>asynchronous</strong></h1>

<h1>==</h1>

<h1><strong>HYPE</strong>?</h1></div>
</div><div class="slide" data-transition="none"><div class="content center" ref="one/01_slide/7">
<h1>life is evented</h1>

<p><img src="./file/one/async_1.png" alt="aldea"/></p></div>
</div><div class="slide" data-transition="none"><div class="content center" ref="one/01_slide/8">
<h1>life is evented</h1>

<p><img src="./file/one/async_2.png" alt="aldea"/></p></div>
</div><div class="slide" data-transition="none"><div class="content center" ref="one/01_slide/9">
<h1>life is evented</h1>

<p><img src="./file/one/async_3.png" alt="aldea"/></p></div>
</div><div class="slide" data-transition="none"><div class="content center" ref="one/01_slide/10">
<h1>life is evented</h1>

<p><img src="./file/one/async_4.png" alt="aldea"/></p></div>
</div><div class="slide" data-transition="none"><div class="content" ref="one/01_slide/11">
<h1>when?</h1>

<ul>
<li>handle lots of concurrents</li>
<li>websockets/longpoll</li>
<li>'realtime' interaction</li>
<li>network applications</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="one/01_slide/12">
<h1>silver bullet?</h1>

<h2>Node.js is Cancer</h2></div>
</div><div class="slide" data-transition="none"><div class="content" ref="one/01_slide/13">
<h1>frameworks</h1>

<ul>
<li>nodejs - javascript</li>
<li>eventmachine - ruby</li>
<li>twisted, gevent... - python</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content small" ref="one/01_slide/14">
<h1>the basics</h1>

<pre class="sh_python"><code>  OS_register(socket_fd, READ)
  ...
  while True:
      events = OS_get_events() #epoll, select...
      for fd, event_type in events:
        fn = callback_for(fd, event_type)
        fn()</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content center corte" ref="one/01_slide/15">
<h1>TORNADO</h1>

<h2><strong>async</strong> web framework</h2></div>
</div><div class="slide" data-transition="none"><div class="content center" ref="one/01_slide/16">
<h1>others</h1>

<ul>
<li>django</li>
<li>flask</li>
<li>pylons/pyramid, turbogears ...</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content center" ref="one/01_slide/17">
<h1>sorry, <strong>no benchmarks</strong></h1></div>
</div><div class="slide" data-transition="none"><div class="content center" ref="one/01_slide/18">
<h1>overview</h1>

<ul>
<li>small &#xB7; fast &#xB7; simple</li>
<li>focus on fundamentals: no models, routes, templates...</li>
<li>non-blocking I/O</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content center" ref="one/01_slide/19">
<h1>history</h1>

<h2>friendfeed =&gt; facebook</h2></div>
</div><div class="slide" data-transition="none"><div class="content center" ref="one/01_slide/20">
<h1>fist step, hello world</h1></div>
</div><div class="slide" data-transition="none"><div class="content small" ref="one/01_slide/21">
<pre class="sh_python"><code>    import tornado.ioloop
    import tornado.web

    # controller
    class MainHandler(tornado.web.RequestHandler):
        def get(self):
            self.write("Hello, world")

    # router + settings
    application = tornado.web.Application([
        (r"/", MainHandler),
    ])

    if __name__ == "__main__":
        application.listen(8888)
        tornado.ioloop.IOLoop.instance().start()</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content commandline" ref="one/01_slide/22">
<pre><code><code class="command">$ curl -i http://localhost:8888</code>
<code class="result">
HTTP/1.1 200 OK
Content-Length: 12
Etag: "e02aa1b106d5c7c6a98def2b13005d5b84fd8dc8"
Content-Type: text/html; charset=UTF-8
Server: TornadoServer/2.1.1

Hello, world
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content corte center" ref="one/01_slide/23">
<h1>features</h1></div>
</div><div class="slide" data-transition="none"><div class="content small" ref="one/01_slide/24">
<h1>views/controllers</h1>

<pre class="sh_html"><code>    &lt;!-- index.html --&gt;
    &lt;html&gt;
        &lt;h1&gt;{{msg}}&lt;/h1&gt;
    &lt;/html&gt;</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content small" ref="one/01_slide/25">
<h1>views/controllers</h1>

<pre class="sh_python"><code>class MainHandler(tornado.web.RequestHandler):
    def get(self):
        self.render("index.html", msg="hello!")</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content commandline" ref="one/01_slide/26">
<pre><code><code class="command">$ curl -i http://localhost:8888</code>
<code class="result">
HTTP/1.1 200 OK
Content-Length: 32
Etag: "3e7020fdb7b87ef428cbdd140c96217044748c27"
Content-Type: text/html; charset=UTF-8
Server: TornadoServer/2.1.1

&lt;html&gt;
&lt;h1&gt; hello!&lt;/h1&gt;
&lt;/html&gt;
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content small" ref="one/01_slide/27">
<h1>json</h1>

<pre class="sh_python"><code>
class JSONHandler(tornado.web.RequestHandler):
    def get(self):
        self.write({'msg': "hello!"})

application = tornado.web.Application([
    (r"/", MainHandler),
    (r"/json", JSONHandler),
])</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content commandline" ref="one/01_slide/28">
<pre><code><code class="command">$ curl -i http://localhost:8888/json</code>
<code class="result">
HTTP/1.1 200 OK
Content-Length: 17
Etag: "4d34dd0d61eba5957a5ca36846f974697c730a22"
Content-Type: application/json; charset=UTF-8
Server: TornadoServer/2.1.1

{"msg": "hello!"}
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content small" ref="one/01_slide/29">
<h1>templates</h1>

<ul>
<li>inherance</li>
<li>for, if, autoescape...</li>
<li>IU Modules</li>
<li><p><strong>no limits</strong>, just python code</p>

<pre class="sh_html"><code> {% for student in 
     [p for p in people 
         if p.student and p.age &gt; 23] %}
   &lt;li&gt;{{ epic_function(student.name) }}&lt;/li&gt;
 {% end %}</code></pre></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content small" ref="one/01_slide/30">
<h1>async code</h1>

<h2>external http service example</h2></div>
</div><div class="slide" data-transition="none"><div class="content smaller" ref="one/01_slide/31">
<pre class="sh_python"><code>
SEARCH = "http://search.twitter.com/search.json?q=bcndevcon"
class APIHandler(tornado.web.RequestHandler):

    @tornado.web.asynchronous
    def get(self):
      http = tornado.httpclient.AsyncHTTPClient()
      http.fetch(SEARCH,
        callback=self.async_callback(
            self.on_response # &lt;== call here when done
        )
      )

    def on_response(self, response): # &lt;== HERE!
        json = tornado.escape.json_decode(response.body)
        self.write({
          "twits": [x['text'] for x in json["results"]]
        })
        self.finish()</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content commandline small" ref="one/01_slide/32">
<pre><code><code class="command">$ curl http://localhost:8888/api | python -m json.tool</code>
<code class="result">
{
    "twits": [
        "Llegando a la. #bcndevconf A conocer a Lucia @wiseri :-)", 
        "De camino a #bcndevconf. Tres d\u00edas de congreso en el museo mar\u00edtimo de barcelona. A ver q tal", 
        "On my way to BCN with @davideme and tomorrow BCNDevConf!", 
        "@wulczer vas a estar t\u00fa en la bcndevconf hablando de ducksboard?", 
        "In extremis, per\u00f2 l'equip de @shopsial acaba de comprar els early tickets per el #bcndevconf Ens veiem all\u00e0 la setmana que ve!!", 
        "@ValentiGoClimb @bcndevconf see you there!", 
        "+1 RT @ValentiGoClimb: i will be in @bcndevconf on Saturday 19! #bdc11", 
        "i will be in @bcndevconf on Saturday 19! #bdc11"
    ]
}
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="one/01_slide/33">
<h1>websockets</h1></div>
</div><div class="slide" data-transition="none"><div class="content smaller" ref="one/01_slide/34">
<pre class="sh_javascript"><code>// websocket.html
window.onload = function() {

    var WS = typeof WebSocket === 'function' ? WebSocket : MozWebSocket;
    var ws = new WS("ws://localhost:8888/api");

    ws.onopen = function() {
       ws.send("Hello");
    };

    ws.onmessage = function (evt) {
       var h = "&lt;h1&gt;" + new Date().toString() + "&lt;/h1&gt;";
       h += "&lt;ul&gt;";
       JSON.parse(evt.data).twits.forEach(function(r) {
          h += "&lt;li&gt;" + r;
       });
       h += "&lt;/ul&gt;";
       document.body.innerHTML = h;
    };
}</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content smaller" ref="one/01_slide/35">
<pre class="sh_python"><code># websocket handler
# clients
clients = [] #&lt;= 1 thread!

class APIWebSocket(websocket.WebSocketHandler):
    def open(self):
        clients.append(self) # &lt;= add the client to the list

    def on_message(self, message):
        print message

    def on_close(self):
        print "client diconnected"
        #TODO: remove the client from clients list

# route
application = tornado.web.Application([
    (r"/api", APIWebSocket),
])</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content smaller" ref="one/01_slide/36">
<pre class="sh_python"><code># get tweets task
def check_twitter(s='bcndevcon'):
    http = tornado.httpclient.AsyncHTTPClient()
    http.fetch("http://search.twitter.com/search.json?q=" + s,
               callback=new_twitts) #&lt;= callback

# setup a periodic task
p = PeriodicCallback(check_twitter, 3000)
p.start()

# callback for twitter search 
def new_twitts(response):
    json = tornado.escape.json_decode(response.body)
    data = {"twits": [x['text'] for x in json["results"]]}
    broadcast(data) # &lt;= broadcast to all clients


def broadcast(data):
    for c in clients:
        c.write_message(data) #&lt;= write to websockets</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="one/01_slide/37">
<h1>socket.io</h1>

<h2>tornadio2</h2></div>
</div><div class="slide" data-transition="none"><div class="content center smaller" ref="one/01_slide/38">
<h2>http://blog.aleksandarrodic.com/?p=93</h2>

<p><img src="./file/one/wall.png" alt="walls"/></p></div>
</div><div class="slide" data-transition="none"><div class="content small" ref="one/01_slide/39">
<h1>more</h1>

<ul>
<li>secure cookies</li>
<li>mysql database helper (sync)</li>
<li>oauth/twitter/gooogle/facebook mixins</li>
<li>twisted connector</li>
<li>decorators: auth, <strong>gen</strong></li>
<li>process management</li>
<li>python3!</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="one/01_slide/40">
<h1>the bad</h1>

<ul>
<li>expection handling (solved in 2.x)</li>
<li>no ORM, forms, session...</li>
<li>no dev tools (middleware...)</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content corte center" ref="one/01_slide/41">
<h1>production</h1></div>
</div><div class="slide" data-transition="none"><div class="content" ref="one/01_slide/42">
<h1>when</h1>

<ul>
<li>API</li>
<li>connectors</li>
<li>fast/realtime stuff</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content small" ref="one/01_slide/43">
<h1>when <strong>not</strong> to use</h1>

<ul>
<li>as general framework</li>
<li>no ORM</li>
<li>no forms handling</li>
<li>no general 3rd party plugins</li>
<li>3rd party plugins =&gt; <strong>broken</strong> =&gt; be careful</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="one/01_slide/44">
<h1>setup</h1>

<ul>
<li>behind a proxy (nginx)</li>
<li>websockets

<ul>
<li>HTTP 1.1 proxy</li>
<li>tornado =&gt; port XXXX</li>
</ul>
</li>
<li>workers + redis</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content small" ref="one/01_slide/45">
<h1>nginx</h1>

<pre class="sh_sh"><code># simplified config
http {
    upstream frontends {
        server 127.0.0.1:8000;
    }
    server {
        location ^~ /static/ {
            root /home/www/app/static;
            if ($query_string) { expires max; }
        }
        location / {
            proxy_pass http://frontends;
        }
    }
}</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content smaller" ref="one/01_slide/46">
<h1>supervisor</h1>

<pre class="sh_sh"><code>[program:tornado]
command=/home/www/app/env/bin/python /home/www/app/src/app.py
directory=/home/www/app/
user=no_root;</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content corte center" ref="one/01_slide/47">
<h1>final thoughts</h1></div>
</div><div class="slide" data-transition="none"><div class="content" ref="one/01_slide/48">
<h2>simple</h2>

<h2>fast</h2>

<h2>no silver bullet</h2>

<h2>good python project</h2>

<h2>micro framework</h2></div>
</div><div class="slide" data-transition="none"><div class="content end bullets" ref="one/01_slide/49">
<h1>fin</h1>

<h2>&#xBF;Questions?</h2>

<p>@javisantana</p></div>
</div><div class="slide" data-transition="none"><div class="content" ref="one/01_slide/50">
<h1>links</h1>

<ul>
<li>http://www.tornadoweb.org/</li>
<li>http://bret.appspot.com/entry/tornado-web-server</li>
<li>tornado code on github</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="one/01_slide/51">
<h1>refs</h1>

<ul>
<li>bret taylor tornado presentation</li>
<li>@tokumine conferencia rails nodejs slides</li>
</ul>
</div>
</div></div>

</body>
</html>
